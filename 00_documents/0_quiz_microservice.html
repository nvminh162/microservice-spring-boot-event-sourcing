<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz</title>
  <style>
    * {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell,
        "Open Sans", "Helvetica Neue", sans-serif;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-size: 16px;
    }

    main {
      padding-top: 48px;
    }

    :root {
      --large-device-width: 850px;
      --primary-color: #0f172a;
      --secondary-color: #020617;
      --primary-text-color: #c7d1dd;
      --secondary-text-color: #061602;
      --success-background: hsl(159, 82%, 24%);
      --success-foreground: hsl(164, 86%, 16%);
      --success: hsl(160, 84%, 39%);
      --danger: #ef4444;
      --warning: #f59e0b;
      --info-background: hsl(218, 81%, 8%);
      --info-foreground: hsl(217, 91%, 85%);
      --border-color: #d1d7dc;
      --check-box-size: 20px;
      /* control the size */
      --check-box-color: var(--info-foreground);
      /* the active color */
    }

    body {
      position: relative;
      background-color: #020617;
      color: var(--primary-text-color);
    }

    #score-stats-container {
      position: fixed;
      z-index: 10;
      top: 0;
      height: 40px;
      width: 100%;
      background-color: var(--info-background);

      padding: 0px 16px;
      color: var(--info-foreground);
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    #quiz-container {
      border-radius: 8px;
      display: flex;
      gap: 16px;
      flex-direction: column;
    }

    /* === Base Styles for both Radio and Checkbox === */
    input[type="radio"],
    input[type="checkbox"] {
        height: var(--check-box-size);
        aspect-ratio: 1;
        border: calc(var(--check-box-size) / 8) solid #939393;
        padding: calc(var(--check-box-size) / 8);
        background: radial-gradient(farthest-side, var(--check-box-color) 94%, #0000) 50%/0 0 no-repeat content-box;
        outline-offset: calc(var(--check-box-size) / 10);
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        cursor: pointer;
        font-size: inherit;
        transition: 0.3s;
    }

    input[type="radio"]:checked,
    input[type="checkbox"]:checked {
        border-color: var(--check-box-color);
        background-size: 100% 100%;
    }

    input[type="radio"]:disabled,
    input[type="checkbox"]:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* === Specific Styles === */
    input[type="radio"] {
      border-radius: 50%; /* Makes it a circle */
    }
    
    input[type="checkbox"] {
        border-radius: 4px; /* Makes it a square */
    }
    
    label {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      padding: 4px 6px;
      border-radius: 4px;
    }

    @media (max-width: 767px) {

      input[type="radio"],
      input[type="checkbox"],
      label {
        cursor: default;
      }

      #quiz-container {
        margin-left: 8px;
        margin-right: 8px;
      }
    }

    /* PC (Desktop devices) */
    @media (min-width: 768px) {
      body {
        display: flex;
        justify-content: center;
      }

      main {
        max-width: var(--large-device-width);
      }

      #score-stats-container {
        max-width: var(--large-device-width);
      }

      dialog {
        max-width: var(--large-device-width);
      }
    }

    @media print {
        input[type="radio"],
        input[type="checkbox"] {
            background: none !important;
            border-color: #939393 !important;
        }

        input[type="radio"]:checked,
        input[type="checkbox"]:checked {
            border-color: #939393 !important;
        }
    }

    .question-lable {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      outline: none;
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    .button {
      background-color: var(--success-background);
      border: none;
      color: #f4f5f7;
      opacity: 0.8;
      font-size: 18px;
      flex-grow: 1;
      padding: 8px 16px;
      border-radius: 8px;
    }

    .button:hover {
      opacity: 1;
    }

    .button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .explanation-btn {
      border: none;
      color: var(--success);
      background-color: transparent;
    }

    .single-question-container {
      background-color: var(--primary-color);
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 16px;
      border-radius: 8px;
    }

    #modal-content {
      padding: 16px;
      line-height: 24px;
    }

    dialog::backdrop {
      background: rgba(0, 0, 0, 0.5);
    }

    dialog {
      position: fixed;
      border: 1px solid var(--border-color);
      background-color: var(--primary-color);
      color: rgb(240, 241, 248);
      padding: 16px;
      border-radius: 8px;
      width: 80vw;
      max-height: 80vh;
      overflow: auto;
      top: 50%;
      left: 50%;
      transform: translateX(-50%) translateY(-50%);
    }

    #close-modal-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      padding: 2px 8px;
      border-radius: 2px;
      border: none;
      background-color: var(--danger);
    }

    .correct-answer > label {
      border: 2px solid var(--success);
      width: 100%;
    }

    .incorrect-answer > label {
      border: 2px solid var(--danger);
      width: 100%;
    }

    .options-container {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    #quiz-meta-container {
      border-radius: 8px;
      background-color: var(--primary-color);
      margin-bottom: 12px;
      padding: 8px;
    }

    #quiz-title {
      text-align: center;
      font-size: 24px;
      margin-bottom: 8px;
    }

    #quiz-description {
      line-height: 1.5;
      padding: 2px 6px;
    }
  </style>
</head>

<body onload="main()">
  <main>
    <section id="quiz-meta-container">
      <h1 id="quiz-title"></h1>
      <p id="quiz-description"></p>
    </section>
    <section id="score-stats-container">
      <div id="score-card">
        Score: <span id="current-score">999</span> of
        <span id="pass-percent">999%</span>
      </div>
      <div>Correct: <span id="correct-answers">999</span></div>
      <div>Incorrect: <span id="wrong-answers">999</span></div>
    </section>

    <section id="quiz-container"></section>

    <dialog id="modal" class="modal-container">
      <div id="modal-content">
        <p id="modal-text"></p>
      </div>
    </dialog>
  </main>

  <script>
    const quizData = {"pass_percent": null, "questions": [{"_class": "assessment", "id": 60840646, "assessment_type": "multiple-choice", "prompt": {"question": "<p>Microservice l\u00e0 g\u00ec?</p>", "relatedLectureIds": ["37834340"], "feedbacks": ["", "", "Microservice l\u00e0 m\u1ed9t ki\u1ebfn tr\u00fac ph\u1ea7n m\u1ec1m ph\u00e2n t\u00e1n, trong \u0111\u00f3 c\u00e1c \u1ee9ng d\u1ee5ng l\u1edbn \u0111\u01b0\u1ee3c chia th\u00e0nh c\u00e1c th\u00e0nh ph\u1ea7n nh\u1ecf h\u01a1n \u0111\u01b0\u1ee3c g\u1ecdi l\u00e0 d\u1ecbch v\u1ee5. M\u1ed7i d\u1ecbch v\u1ee5 c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c ph\u00e1t tri\u1ec3n v\u00e0 tri\u1ec3n khai \u0111\u1ed9c l\u1eadp v\u1edbi c\u00e1c d\u1ecbch v\u1ee5 kh\u00e1c, v\u00e0 c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c giao ti\u1ebfp v\u1edbi c\u00e1c d\u1ecbch v\u1ee5 kh\u00e1c th\u00f4ng qua c\u00e1c giao th\u1ee9c chu\u1ea9n."], "answers": ["<p>M\u1ed9t ki\u1ebfn tr\u00fac ph\u1ea7n m\u1ec1m</p>", "<p>M\u1ed9t ki\u1ebfn tr\u00fac ph\u1ea7n m\u1ec1m</p>", "<p>M\u1ed9t ph\u01b0\u01a1ng ph\u00e1p chia nh\u1ecf c\u00e1c \u1ee9ng d\u1ee5ng th\u00e0nh c\u00e1c th\u00e0nh ph\u1ea7n nh\u1ecf h\u01a1n</p>"]}, "correct_response": ["c"], "section": "", "question_plain": "Microservice l\u00e0 g\u00ec?", "related_lectures": [{"_class": "lecture", "id": 37834340, "title": "25 phu\u0301t hi\u00ea\u0309u ro\u0303 v\u00ea\u0300 microservice", "created": "2023-05-11T16:49:19Z", "is_published": true, "asset": {"_class": "asset", "id": 48728082, "asset_type": "Video", "title": "y2meta.com-25 Ph\u00fat Hi\u1ec3u R\u00f5 v\u1ec1 Microservice Architecture-(1080p).mp4", "created": "2023-05-11T16:53:14Z"}, "object_index": 3, "url": "/course/thuc-chien-microservice-voi-spring-boot-va-event-sourcing/learn/lecture/37834340"}]}, {"_class": "assessment", "id": 60840658, "assessment_type": "multiple-choice", "prompt": {"question": "<p>T\u1ea1i sao Microservice tr\u1edf n\u00ean ph\u1ed5 bi\u1ebfn trong c\u00e1c \u1ee9ng d\u1ee5ng ph\u1ea7n m\u1ec1m?</p>", "relatedLectureIds": ["37834340"], "feedbacks": ["", "", "", "Microservice gi\u00fap gi\u1ea3m chi ph\u00ed ph\u00e1t tri\u1ec3n ph\u1ea7n m\u1ec1m b\u1eb1ng c\u00e1ch chia nh\u1ecf c\u00e1c \u1ee9ng d\u1ee5ng th\u00e0nh c\u00e1c d\u1ecbch v\u1ee5 nh\u1ecf h\u01a1n v\u00e0 c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c ph\u00e1t tri\u1ec3n \u0111\u1ed9c l\u1eadp. N\u00f3 c\u0169ng cho ph\u00e9p ph\u00e1t tri\u1ec3n nhanh ch\u00f3ng v\u00e0 tri\u1ec3n khai linh ho\u1ea1t, gi\u00fap gi\u1ea3m th\u1eddi gian ph\u00e1t tri\u1ec3n \u1ee9ng d\u1ee5ng v\u00e0 t\u0103ng t\u00ednh s\u1eb5n s\u00e0ng c\u1ee7a \u1ee9ng d\u1ee5ng."], "answers": ["<p>N\u00f3 gi\u00fap gi\u1ea3m chi ph\u00ed ph\u00e1t tri\u1ec3n ph\u1ea7n m\u1ec1m</p>", "<p>N\u00f3 cho ph\u00e9p ph\u00e1t tri\u1ec3n nhanh ch\u00f3ng v\u00e0 tri\u1ec3n khai linh ho\u1ea1t</p>", "<p>N\u00f3 t\u0103ng t\u00ednh b\u1ea3o m\u1eadt c\u1ee7a \u1ee9ng d\u1ee5ng</p>", "<p>T\u1ea5t c\u1ea3 c\u00e1c ph\u01b0\u01a1ng \u00e1n tr\u00ean</p>"]}, "correct_response": ["d"], "section": "", "question_plain": "T\u1ea1i sao Microservice tr\u1edf n\u00ean ph\u1ed5 bi\u1ebfn trong c\u00e1c \u1ee9ng d\u1ee5ng ph\u1ea7n m\u1ec1m?", "related_lectures": [{"_class": "lecture", "id": 37834340, "title": "25 phu\u0301t hi\u00ea\u0309u ro\u0303 v\u00ea\u0300 microservice", "created": "2023-05-11T16:49:19Z", "is_published": true, "asset": {"_class": "asset", "id": 48728082, "asset_type": "Video", "title": "y2meta.com-25 Ph\u00fat Hi\u1ec3u R\u00f5 v\u1ec1 Microservice Architecture-(1080p).mp4", "created": "2023-05-11T16:53:14Z"}, "object_index": 3, "url": "/course/thuc-chien-microservice-voi-spring-boot-va-event-sourcing/learn/lecture/37834340"}]}, {"_class": "assessment", "id": 60840668, "assessment_type": "multiple-choice", "prompt": {"question": "<p>C\u00e1c d\u1ecbch v\u1ee5 Microservice ph\u1ea3i tu\u00e2n theo quy t\u1eafc g\u00ec \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o t\u00ednh nh\u1ea5t qu\u00e1n?</p>", "relatedLectureIds": ["37834340"], "feedbacks": ["", "", "", "C\u00e1c d\u1ecbch v\u1ee5 Microservice ph\u1ea3i c\u00f3 kh\u1ea3 n\u0103ng ho\u1ea1t \u0111\u1ed9ng (Operability) \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o t\u00ednh nh\u1ea5t qu\u00e1n. \u0110i\u1ec1u n\u00e0y \u0111\u00f2i h\u1ecfi c\u00e1c d\u1ecbch v\u1ee5 Microservice ph\u1ea3i \u0111\u01b0\u1ee3c thi\u1ebft k\u1ebf v\u00e0 tri\u1ec3n khai m\u1ed9t c\u00e1ch \u0111\u00fang \u0111\u1eafn, c\u00f3 kh\u1ea3 n\u0103ng qu\u1ea3n l\u00fd, gi\u00e1m s\u00e1t, v\u00e0 \u0111\u01b0a ra c\u1ea3nh b\u00e1o khi c\u00f3 s\u1ef1 c\u1ed1 x\u1ea3y ra. Ngo\u00e0i ra, c\u00e1c d\u1ecbch v\u1ee5 c\u1ea7n \u0111\u01b0\u1ee3c t\u1ef1 \u0111\u1ed9ng h\u00f3a \u0111\u1ec3 gi\u1ea3m thi\u1ec3u nh\u00e2n l\u1ef1c v\u00e0 t\u0103ng t\u00ednh \u0111\u00e1ng tin c\u1eady c\u1ee7a h\u1ec7 th\u1ed1ng. Qu\u1ea3n l\u00fd v\u00e0 gi\u00e1m s\u00e1t \u0111\u00fang \u0111\u1eafn s\u1ebd gi\u00fap cho vi\u1ec7c ph\u00e1t hi\u1ec7n v\u00e0 kh\u1eafc ph\u1ee5c s\u1ef1 c\u1ed1 nhanh ch\u00f3ng, gi\u1ea3m thi\u1ec3u th\u1eddi gian gi\u00e1n \u0111o\u1ea1n v\u00e0 t\u0103ng t\u00ednh kh\u1ea3 d\u1ee5ng c\u1ee7a h\u1ec7 th\u1ed1ng."], "answers": ["<p>C\u00e1c d\u1ecbch v\u1ee5 Microservice ph\u1ea3i c\u00f3 kh\u1ea3 n\u0103ng ho\u1ea1t \u0111\u1ed9ng \u0111\u1ed9c l\u1eadp v\u1edbi c\u00e1c d\u1ecbch v\u1ee5 kh\u00e1c v\u00e0 kh\u00f4ng ph\u1ee5 thu\u1ed9c v\u00e0o ch\u00fang.</p>", "<p>C\u00e1c d\u1ecbch v\u1ee5 Microservice ph\u1ea3i s\u1eed d\u1ee5ng c\u00e1c giao th\u1ee9c chu\u1ea9n v\u00e0 c\u00f3 th\u1ec3 giao ti\u1ebfp v\u1edbi nhau th\u00f4ng qua c\u00e1c giao th\u1ee9c n\u00e0y.</p>", "<p>C\u00e1c d\u1ecbch v\u1ee5 Microservice ph\u1ea3i c\u00f3 kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng v\u00e0 c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c tri\u1ec3n khai tr\u00ean nhi\u1ec1u m\u00e1y ch\u1ee7.</p>", "<p>T\u1ea5t c\u1ea3 c\u00e1c ph\u01b0\u01a1ng \u00e1n tr\u00ean.</p>"]}, "correct_response": ["d"], "section": "", "question_plain": "C\u00e1c d\u1ecbch v\u1ee5 Microservice ph\u1ea3i tu\u00e2n theo quy t\u1eafc g\u00ec \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o t\u00ednh nh\u1ea5t qu\u00e1n?", "related_lectures": [{"_class": "lecture", "id": 37834340, "title": "25 phu\u0301t hi\u00ea\u0309u ro\u0303 v\u00ea\u0300 microservice", "created": "2023-05-11T16:49:19Z", "is_published": true, "asset": {"_class": "asset", "id": 48728082, "asset_type": "Video", "title": "y2meta.com-25 Ph\u00fat Hi\u1ec3u R\u00f5 v\u1ec1 Microservice Architecture-(1080p).mp4", "created": "2023-05-11T16:53:14Z"}, "object_index": 3, "url": "/course/thuc-chien-microservice-voi-spring-boot-va-event-sourcing/learn/lecture/37834340"}]}, {"_class": "assessment", "id": 60840676, "assessment_type": "multiple-choice", "prompt": {"question": "<p>L\u1ee3i \u00edch ch\u00ednh c\u1ee7a vi\u1ec7c s\u1eed d\u1ee5ng microservice l\u00e0 g\u00ec?</p>", "relatedLectureIds": ["37834340"], "feedbacks": ["", "", "", "Vi\u1ec7c s\u1eed d\u1ee5ng microservice mang l\u1ea1i nhi\u1ec1u l\u1ee3i \u00edch cho c\u00e1c t\u1ed5 ch\u1ee9c v\u00e0 nh\u00e0 ph\u00e1t tri\u1ec3n, bao g\u1ed3m:  T\u00ednh linh ho\u1ea1t v\u00e0 m\u1edf r\u1ed9ng: C\u00e1c d\u1ecbch v\u1ee5 \u0111\u01b0\u1ee3c ph\u00e2n t\u00e1ch v\u00e0 tri\u1ec3n khai \u0111\u1ed9c l\u1eadp v\u1edbi nhau, cho ph\u00e9p t\u1ed5 ch\u1ee9c c\u00f3 th\u1ec3 d\u1ec5 d\u00e0ng m\u1edf r\u1ed9ng ho\u1eb7c thu nh\u1ecf c\u00e1c d\u1ecbch v\u1ee5 m\u1ed9t c\u00e1ch linh ho\u1ea1t theo nhu c\u1ea7u c\u1ee7a h\u1ecd.  D\u1ec5 d\u00e0ng qu\u1ea3n l\u00fd v\u00e0 b\u1ea3o tr\u00ec: C\u00e1c d\u1ecbch v\u1ee5 c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c qu\u1ea3n l\u00fd v\u00e0 b\u1ea3o tr\u00ec \u0111\u1ed9c l\u1eadp v\u1edbi nhau, gi\u00fap t\u0103ng t\u00ednh kh\u1ea3 d\u1ee5ng v\u00e0 gi\u1ea3m thi\u1ec3u th\u1eddi gian ch\u1ebft c\u1ee7a to\u00e0n b\u1ed9 h\u1ec7 th\u1ed1ng.  Ph\u00e1t tri\u1ec3n \u0111\u1ed9c l\u1eadp: C\u00e1c d\u1ecbch v\u1ee5 c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c ph\u00e1t tri\u1ec3n v\u00e0 c\u1eadp nh\u1eadt \u0111\u1ed9c l\u1eadp v\u1edbi nhau, gi\u00fap t\u0103ng t\u00ednh \u0111\u1ed9c l\u1eadp v\u00e0 gi\u1ea3m thi\u1ec3u r\u1ee7i ro khi x\u1ea3y ra l\u1ed7i trong"], "answers": ["<p>T\u00ednh linh ho\u1ea1t cao v\u00e0 d\u1ec5 d\u00e0ng m\u1edf r\u1ed9ng</p>", "<p>\u0110\u1ed9 tin c\u1eady cao v\u00e0 gi\u1ea3m thi\u1ec3u th\u1eddi gian gi\u00e1n \u0111o\u1ea1n</p>", "<p>Gi\u1ea3m chi ph\u00ed v\u00e0 t\u0103ng t\u1ed1c \u0111\u1ed9 ph\u00e1t tri\u1ec3n</p>", "<p>T\u1ea5t c\u1ea3 c\u00e1c ph\u01b0\u01a1ng \u00e1n tr\u00ean</p>"]}, "correct_response": ["d"], "section": "", "question_plain": "L\u1ee3i \u00edch ch\u00ednh c\u1ee7a vi\u1ec7c s\u1eed d\u1ee5ng microservice l\u00e0 g\u00ec?", "related_lectures": [{"_class": "lecture", "id": 37834340, "title": "25 phu\u0301t hi\u00ea\u0309u ro\u0303 v\u00ea\u0300 microservice", "created": "2023-05-11T16:49:19Z", "is_published": true, "asset": {"_class": "asset", "id": 48728082, "asset_type": "Video", "title": "y2meta.com-25 Ph\u00fat Hi\u1ec3u R\u00f5 v\u1ec1 Microservice Architecture-(1080p).mp4", "created": "2023-05-11T16:53:14Z"}, "object_index": 3, "url": "/course/thuc-chien-microservice-voi-spring-boot-va-event-sourcing/learn/lecture/37834340"}]}, {"_class": "assessment", "id": 60840684, "assessment_type": "multiple-choice", "prompt": {"question": "<p>Microservice c\u00f3 nh\u01b0\u1ee3c \u0111i\u1ec3m g\u00ec?</p>", "relatedLectureIds": ["37834340"], "feedbacks": ["", "", "", "\u0110\u1ed9 ph\u1ee9c t\u1ea1p: H\u1ec7 th\u1ed1ng Microservice c\u00f3 th\u1ec3 r\u1ea5t ph\u1ee9c t\u1ea1p, \u0111\u1eb7c bi\u1ec7t l\u00e0 trong vi\u1ec7c qu\u1ea3n l\u00fd c\u00e1c d\u1ecbch v\u1ee5 v\u00e0 giao ti\u1ebfp gi\u1eefa ch\u00fang.  T\u0103ng \u0111\u1ed9 ph\u1ee9c t\u1ea1p c\u1ee7a vi\u1ec7c tri\u1ec3n khai: V\u1edbi Microservice, vi\u1ec7c tri\u1ec3n khai v\u00e0 qu\u1ea3n l\u00fd c\u00e1c d\u1ecbch v\u1ee5 ph\u1ea3i \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n \u0111\u1ed9c l\u1eadp v\u1edbi nhau, d\u1eabn \u0111\u1ebfn t\u0103ng \u0111\u1ed9 ph\u1ee9c t\u1ea1p trong vi\u1ec7c tri\u1ec3n khai.  T\u0103ng chi ph\u00ed ph\u00e1t tri\u1ec3n: Ph\u00e1t tri\u1ec3n c\u00e1c d\u1ecbch v\u1ee5 Microservice y\u00eau c\u1ea7u m\u1ed9t m\u1ee9c \u0111\u1ed9 k\u1ef9 n\u0103ng cao h\u01a1n so v\u1edbi c\u00e1c ki\u1ebfn tr\u00fac monolithic truy\u1ec1n th\u1ed1ng, do \u0111\u00f3 t\u0103ng chi ph\u00ed ph\u00e1t tri\u1ec3n.  Kh\u00f3 kh\u0103n trong vi\u1ec7c ki\u1ec3m so\u00e1t d\u1eef li\u1ec7u: V\u00ec c\u00e1c d\u1ecbch v\u1ee5 Microservice th\u01b0\u1eddng ph\u00e2n t\u00e1n v\u00e0 c\u00f3 th\u1ec3 s\u1eed d\u1ee5ng c\u00e1c c\u01a1 s\u1edf d\u1eef li\u1ec7u "], "answers": ["<p>T\u0103ng \u0111\u1ed9 ph\u1ee9c t\u1ea1p c\u1ee7a h\u1ec7 th\u1ed1ng</p>", "<p>\u0110\u1ed9 tin c\u1eady th\u1ea5p v\u00e0 kh\u00f3 qu\u1ea3n l\u00fd</p>", "<p>Chi ph\u00ed cao v\u00e0 kh\u00f3 tri\u1ec3n khai</p>", "<p>T\u1ea5t c\u1ea3 c\u00e1c ph\u01b0\u01a1ng \u00e1n tr\u00ean</p>"]}, "correct_response": ["d"], "section": "", "question_plain": "Microservice c\u00f3 nh\u01b0\u1ee3c \u0111i\u1ec3m g\u00ec?", "related_lectures": [{"_class": "lecture", "id": 37834340, "title": "25 phu\u0301t hi\u00ea\u0309u ro\u0303 v\u00ea\u0300 microservice", "created": "2023-05-11T16:49:19Z", "is_published": true, "asset": {"_class": "asset", "id": 48728082, "asset_type": "Video", "title": "y2meta.com-25 Ph\u00fat Hi\u1ec3u R\u00f5 v\u1ec1 Microservice Architecture-(1080p).mp4", "created": "2023-05-11T16:53:14Z"}, "object_index": 3, "url": "/course/thuc-chien-microservice-voi-spring-boot-va-event-sourcing/learn/lecture/37834340"}]}]};

     let correct = new Set();
    let incorrect = new Set();
    let totalNumberOfQuestions = 0;
    const quizTitle = quizData.quiz_title || "Quiz";
    const quizDescription = quizData.quiz_description || "Please answer the questions below.";
    const questionData = quizData.questions;
    const passPercent = quizData.pass_percent;
    const modalTextElement = document.getElementById("modal-text");
    const quizContainerElement = document.getElementById("quiz-container");
    const dialog = document.querySelector("dialog");
    const closeButton = document.getElementById("close-modal-btn");
    const quizTitleElement = document.getElementById("quiz-title");
    const quizDescriptionElement = document.getElementById("quiz-description");

    function main() {
      // update quiz meta data
      document.title = quizTitle;
      quizTitleElement.innerHTML = quizTitle;
      quizDescriptionElement.innerHTML = quizDescription;

      const passPercentElement = document.getElementById("pass-percent");
      passPercentElement.innerHTML = passPercent ? `${passPercent}%` : "N/A";
      totalNumberOfQuestions = questionData.length;
      
      if(closeButton) {
          closeButton.addEventListener("click", () => dialog.close());
      }

      // shuffle the questionData to randomize the order
      for (let i = questionData.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [questionData[i], questionData[j]] = [questionData[j], questionData[i]];
      }

      let formattedQuestions = questionData.map(formatSingleQuestionData);
      updateScore();
      // display the formattedQuestions
      formattedQuestions.forEach((question, idx) => {
        renderSingleQuestion(question, idx + 1);
      });
    }

    /**
     * Formats the raw question data into a more usable structure.
     */
    function formatSingleQuestionData(singleQuizData = null) {
        const { prompt, correct_response, id, assessment_type } = singleQuizData;
        
        const answers = prompt.answers || [];
        // Create a detailed answer object including correctness
        const formattedAnswers = answers.map((answerText, index) => {
            const letter = String.fromCharCode(97 + index); // a, b, c...
            const isCorrect = correct_response.includes(letter);
            return {
                text: answerText,
                isCorrect: isCorrect
            };
        });

        return {
            id: id,
            assessment_type: assessment_type,
            question: prompt.question,
            answers: formattedAnswers, // Use the new formatted answers
            explanation: prompt?.explanation || "",
            feedbacks: prompt.feedbacks
        };
    }

    /**
     * Renders a single question.
     */
    const renderSingleQuestion = (singleQuestionData = {}, rootIndex = 1) => {
        const { id, explanation, answers, question, feedbacks, assessment_type } = singleQuestionData;

        // shuffle the answers to randomize their order
        // for (let i = answers.length - 1; i > 0; i--) {
        //     const j = Math.floor(Math.random() * (i + 1));
        //     [answers[i], answers[j]] = [answers[j], answers[i]];
        // }
        
        const inputType = assessment_type === 'multi-select' ? 'checkbox' : 'radio';
        const inputName = `answer_${id}`; // Unique name for each question group

        const optionsHTML = answers
            .map((option, index) => {
                const optionId = `${id}_${index}`;
                return `
                <div class="question-lable">
                    <input type="${inputType}" id="${optionId}" name="${inputName}" value="${option.text}" data-is-correct="${option.isCorrect}" />
                    <label for="${optionId}">${option.text}</label>
                </div>
                `;
            })
            .join("");

        const container = document.createElement("div");
        container.innerHTML = `
            <form data-question-id="${id}" class="single-question-container" onsubmit="submitButtonListener(event)">
                <div style="display: flex;justify-content: space-between;">
                    <p style="font-weight: 600">Question ${rootIndex}:</p>
                    <button type="button" onclick="renderExplanation(event)" data-feedbacks='${JSON.stringify(feedbacks)}' data-explanation="${explanation}" class="explanation-btn">View Explanation</button>
                </div>
                <p style="margin-bottom: 8px;line-height: 1.5">${question}</p>
                <div class="options-container">
                    ${optionsHTML}
                </div>
                <div style="display: flex; gap: 8px;">
                    <button type="submit" class="button submit-btn">Submit</button>
                </div>
            </form>
        `;
        quizContainerElement.appendChild(container);
    };

    /**
     * Updates the score board.
     */
    function updateScore() {
        const currentPercentageElement = document.getElementById("current-score");
        const correctAnswerElement = document.getElementById("correct-answers");
        const wrongAnswerElement = document.getElementById("wrong-answers");
        correctAnswerElement.innerHTML = correct.size;
        wrongAnswerElement.innerHTML = incorrect.size;
        if (totalNumberOfQuestions > 0) {
            const score = Number((correct.size / totalNumberOfQuestions) * 100).toFixed(0);
            currentPercentageElement.innerHTML = score;
        }
    }

    /**
    * Compares two sets for equality.
    */
    function setsAreEqual(setA, setB) {
        if (setA.size !== setB.size) {
            return false;
        }
        for (const item of setA) {
            if (!setB.has(item)) {
            return false;
            }
        }
        return true;
    }


    /**
     * Handles the form submission for a single question.
     */
    const submitButtonListener = (e) => {
        e.preventDefault();
        const form = e.target;
        const questionId = form.dataset.questionId;
        const inputs = form.querySelectorAll('input[type="radio"], input[type="checkbox"]');
        
        const userSelectedValues = new Set();
        const actualCorrectValues = new Set();
        let hasSelection = false;

        inputs.forEach(input => {
            if (input.checked) {
                userSelectedValues.add(input.value);
                hasSelection = true;
            }
            if (input.dataset.isCorrect === 'true') {
                actualCorrectValues.add(input.value);
            }
        });

        if (!hasSelection) {
            alert("Please select an answer!");
            return;
        }

        const isFullyCorrect = setsAreEqual(userSelectedValues, actualCorrectValues);

        if (isFullyCorrect) {
            correct.add(questionId);
            incorrect.delete(questionId);
        } else {
            incorrect.add(questionId);
            correct.delete(questionId);
        }
        
        updateScore();

        // Apply visual feedback and disable the form
        form.querySelectorAll(".question-lable").forEach(labelContainer => {
            const input = labelContainer.querySelector('input');
            labelContainer.classList.remove("correct-answer", "incorrect-answer");

            // Highlight all correct answers
            if (input.dataset.isCorrect === 'true') {
                labelContainer.classList.add("correct-answer");
            } 
            // Highlight user's incorrect selections
            else if (input.checked && input.dataset.isCorrect === 'false') {
                labelContainer.classList.add("incorrect-answer");
            }
        });

      
    };

    /**
     * Renders the explanation in a modal dialog.
     */
    function renderExplanation(ev) {
        modalTextElement.innerHTML = '';
        const explanation = ev.target.dataset?.explanation;
        const feedbacksString = ev.target.dataset?.feedbacks;
        let contentFound = false;

        if (explanation && explanation.trim() !== "") {
            modalTextElement.innerHTML += explanation;
            contentFound = true;
        }

        if (feedbacksString) {
            try {
                const feedbacks = JSON.parse(feedbacksString);
                feedbacks.forEach(feedback => {
                    if (feedback && feedback.trim() !== "") {
                        modalTextElement.innerHTML += feedback;
                        contentFound = true;
                    }
                });
            } catch (e) {
                console.error("Error parsing feedbacks JSON:", e);
            }
        }

        if (!contentFound) {
            modalTextElement.innerHTML = "<p>No explanation found for this question.</p>";
        }

        dialog.showModal();
        dialog.addEventListener("click", (event) => {
            if (event.target === dialog) {
                dialog.close();
            }
        });
    }
  </script>
</body>

</html>